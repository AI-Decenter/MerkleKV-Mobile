# Mosquitto Configuration for MerkleKV Mobile Integration Testing
# This configuration supports both TLS and non-TLS modes for comprehensive testing

# Basic Settings
pid_file /var/run/mosquitto.pid
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_type debug

# Connection Settings
max_connections 1000
max_keepalive 65535

# Default non-TLS listener
listener 1883 0.0.0.0
protocol mqtt

# Message Size Limits (aligned with Locked Spec v1.0)
# Key ≤ 256 bytes, Value ≤ 256 KiB, Command ≤ 512 KiB
message_size_limit 524288

# Connection timeout (30 seconds per Locked Spec v1.0)
keepalive_interval 30

# QoS Settings
max_inflight_messages 100
max_queued_messages 1000

# Retain Message Settings
# Note: MerkleKV Mobile uses retain=false per Locked Spec v1.0
retain_available true
max_retained_messages 10000

# WebSocket Support (disabled for MQTT-only compliance)
# listener 9001
# protocol websockets

# Store Settings
autosave_interval 1800
autosave_on_changes false

# Bridge Configuration (for replication testing)
# Bridges will be configured dynamically in tests

# Client Settings
persistent_client_expiration 1h

# Security Headers
set_tcp_nodelay true

# Performance Tuning
sys_interval 10

# Default anonymous access (will be overridden for ACL tests)
allow_anonymous true

# Plugin Support
# plugin /usr/lib/mosquitto_dynamic_security.so
# plugin_opt_config_file /mosquitto/config/dynamic-security.json

# Per-listener Settings Template
# The following sections will be dynamically added by the CI pipeline:

# TLS Configuration Template (added when TLS testing is enabled):
# listener 8883
# cafile /mosquitto/config/certs/ca.crt
# certfile /mosquitto/config/certs/server.crt
# keyfile /mosquitto/config/certs/server.key
# require_certificate false
# use_identity_as_username false
# tls_version tlsv1.2

# ACL Configuration Template (added when ACL testing is enabled):
# acl_file /mosquitto/config/aclfile
# allow_anonymous false
# password_file /mosquitto/config/passwordfile

# Topic Alias Settings (MQTT 5.0 feature, may be used for optimization)
topic_alias_maximum 10

# Subscription Identifier Settings
subscription_identifier_available true

# Shared Subscription Settings (for load balancing scenarios)
shared_subscription_available true

# Response Information Settings
response_information_available false

# Server Keep Alive Settings
server_keepalive 60

# Session Expiry Settings
max_session_expiry_interval 3600

# Will Delay Settings
max_will_delay_interval 300

# Statistics
# $SYS tree publication interval
sys_interval 10

# Include additional configuration files
# include_dir /mosquitto/config/conf.d
