# Mosquitto Configuration for Integration Testing
# Locked Spec compliant configuration for testing

# =============================================================================
# Network Configuration
# =============================================================================

# Default MQTT port (non-TLS)
listener 1883 0.0.0.0
protocol mqtt

# TLS MQTT port
listener 8883 0.0.0.0
protocol mqtt

# =============================================================================
# TLS Configuration
# =============================================================================

# Certificate Authority
cafile /mosquitto/config/tls/ca.crt

# Server certificate and key
certfile /mosquitto/config/tls/server.crt
keyfile /mosquitto/config/tls/server.key

# TLS settings per Locked Spec
tls_version tlsv1.2
require_certificate false
use_identity_as_username false

# =============================================================================
# Authentication and Authorization
# =============================================================================

# Allow anonymous access for basic tests, but also support auth
allow_anonymous true

# Password file for username/password authentication tests
password_file /mosquitto/config/passwd

# Access Control List file for security testing
acl_file /mosquitto/config/acl.conf

# =============================================================================
# Payload Limits (Locked Spec ยง11)
# =============================================================================

# Maximum message size: 1MB (to test 256KiB individual values and 512KiB bulk operations)
message_size_limit 1048576

# =============================================================================
# Connection and QoS Settings
# =============================================================================

# Maximum concurrent connections
max_connections 100

# Maximum inflight messages per client
max_inflight_messages 20

# Maximum queued messages per client (for partition testing)
max_queued_messages 1000

# =============================================================================
# Logging Configuration
# =============================================================================

# Log destinations
log_dest file /mosquitto/log/mosquitto.log
log_dest console

# Log types (verbose for testing)
log_type error
log_type warning
log_type notice
log_type information
log_type debug

# Connection messages
connection_messages true
log_timestamp true

# =============================================================================
# Session and Keepalive Settings
# =============================================================================

# Maximum keepalive time (seconds)
max_keepalive 65535

# Retry interval for outgoing messages
retry_interval 20

# Store clean session flag
store_clean_interval 10

# =============================================================================
# Performance and Testing Settings
# =============================================================================

# Enable persistence for testing message queuing
persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db
autosave_interval 60

# Upgrade QoS (disabled for predictable testing)
upgrade_outgoing_qos false

# MQTT 5.0 settings for compatibility testing
max_packet_size 1048576
topic_alias_maximum 10