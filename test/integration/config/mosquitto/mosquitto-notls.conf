# Mosquitto Configuration for Integration Testing
# Aligned with Locked Spec requirements for MerkleKV

# =============================================================================
# Network Configuration
# =============================================================================

# Default MQTT port (non-TLS)
listener 1883 0.0.0.0
protocol mqtt
socket_domain ipv4

# =============================================================================
# Authentication and Authorization
# =============================================================================

# Allow anonymous access for basic tests (will be restricted in TLS mode)
allow_anonymous true

# =============================================================================
# Message Limits (Locked Spec Compliance)
# =============================================================================

# Maximum individual message size (1MB to accommodate 256KiB values + overhead)
message_size_limit 1048576

# =============================================================================
# Logging Configuration
# =============================================================================

# Logging settings
log_dest stdout
log_type error
log_type warning
log_type information
log_type notice
log_type subscribe
log_type unsubscribe
log_type websockets
log_type none
log_type all

# Connection messages
connection_messages true
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# Performance Settings
# =============================================================================

# Memory limits and performance tuning
max_inflight_messages 20
max_queued_messages 1000
queue_qos0_messages false
retain_available true
set_tcp_nodelay true

# Keep alive settings
keepalive_interval 60
max_keepalive 65535

# =============================================================================
# Security Settings
# =============================================================================

# Disable per listener security for basic testing
per_listener_settings false

# =============================================================================
# Persistence Settings
# =============================================================================

# Persistence settings
persistence true
persistence_location /mosquitto/data/
autosave_interval 1800
autosave_on_changes false

# Retained message settings
max_retained_messages -1

# =============================================================================
# Topic Access Control (Basic)
# =============================================================================

# ACL file (will contain basic topic restrictions)
acl_file /mosquitto/config/acl.conf