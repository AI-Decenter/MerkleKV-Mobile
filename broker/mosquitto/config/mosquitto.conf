# Mosquitto Configuration for MerkleKV Mobile
# Production-ready configuration with TLS and ACL support

# =============================================================================
# Network Configuration
# =============================================================================

# Default MQTT port (non-TLS)
listener 1883 0.0.0.0
protocol mqtt

# TLS MQTT port
listener 8883 0.0.0.0
protocol mqtt

# WebSocket support (optional)
listener 9001 0.0.0.0
protocol websockets

# =============================================================================
# TLS Configuration
# =============================================================================

# Certificate Authority
cafile /mosquitto/config/tls/ca.crt

# Server certificate and key
certfile /mosquitto/config/tls/server.crt
keyfile /mosquitto/config/tls/server.key

# TLS settings
tls_version tlsv1.2
require_certificate false
use_identity_as_username false

# =============================================================================
# Authentication and Authorization
# =============================================================================

# Disable anonymous access
allow_anonymous false

# Password file for username/password authentication
password_file /mosquitto/config/passwd

# Access Control List file
acl_file /mosquitto/config/acl.conf

# =============================================================================
# Persistence Configuration
# =============================================================================

# Enable message persistence
persistence true
persistence_location /mosquitto/data/

# Autosave interval (seconds)
autosave_interval 1800

# Persistence file
persistence_file mosquitto.db

# =============================================================================
# Connection Limits and QoS
# =============================================================================

# Maximum concurrent connections
max_connections 1000

# Maximum inflight messages per client
max_inflight_messages 20

# Maximum queued messages per client
max_queued_messages 1000

# Maximum message size (1MB)
message_size_limit 1048576

# =============================================================================
# Logging Configuration
# =============================================================================

# Log destinations
log_dest file /mosquitto/log/mosquitto.log
log_dest console

# Log types
log_type error
log_type warning
log_type notice
log_type information

# Connection messages
connection_messages true
log_timestamp true

# =============================================================================
# Session and Keepalive Settings
# =============================================================================

# Maximum keepalive time (seconds)
max_keepalive 65535

# Retry interval for outgoing messages
retry_interval 20

# =============================================================================
# Security Settings
# =============================================================================

# Client ID patterns (optional security measure)
# clientid_prefixes merkle_kv_mobile_

# Maximum topic alias (MQTT 5.0)
max_topic_alias 10

# =============================================================================
# Performance Tuning
# =============================================================================

# Store clean session flag
store_clean_interval 10

# Upgrade QoS (useful for mobile clients)
upgrade_outgoing_qos false

# =============================================================================
# MQTT 5.0 Features (if supported)
# =============================================================================

# Maximum packet size
max_packet_size 1048576

# Topic alias maximum
topic_alias_maximum 10

# =============================================================================
# Bridge Configuration (for multi-broker setups)
# =============================================================================

# Example bridge configuration (commented out)
# connection bridge-01
# address remote-broker.example.com:8883
# bridge_protocol_version mqttv311
# bridge_insecure false
# bridge_cafile /mosquitto/config/tls/ca.crt
# bridge_certfile /mosquitto/config/tls/client.crt
# bridge_keyfile /mosquitto/config/tls/client.key
# cleansession true
# topic merkle_kv_mobile/# both 0
# start_type automatic
# restart_timeout 30

# =============================================================================
# Plugin Configuration (if using auth plugins)
# =============================================================================

# Example auth plugin (commented out)
# auth_plugin /usr/lib/auth-plugin.so
# auth_opt_backends mysql
# auth_opt_host localhost
# auth_opt_port 3306
# auth_opt_dbname mosquitto
# auth_opt_user mosquitto
# auth_opt_pass password
