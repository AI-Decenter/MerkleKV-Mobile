# Access Control List for MerkleKV Mobile MQTT Broker
# This file defines who can access which topics

# =============================================================================
# Admin Users - Full Access
# =============================================================================

# Admin user has full access to all topics
user admin
topic readwrite #

# System monitoring user
user monitor
topic read $SYS/#
topic read merkle_kv_mobile/+/status

# =============================================================================
# Device Access Patterns
# =============================================================================

# Pattern for individual device access
# Devices can only access their own command and response topics
# %u is replaced with the username
pattern readwrite merkle_kv_mobile/%u/cmd
pattern readwrite merkle_kv_mobile/%u/res

# All authenticated devices can read from replication events
pattern read merkle_kv_mobile/replication/events

# All authenticated devices can write replication events
pattern write merkle_kv_mobile/replication/events

# Anti-entropy access for all devices
pattern readwrite merkle_kv_mobile/antientropy/%u
pattern read merkle_kv_mobile/antientropy/+

# =============================================================================
# Service Users
# =============================================================================

# Replication service user
user replication_service
topic readwrite merkle_kv_mobile/replication/#
topic read merkle_kv_mobile/+/cmd
topic read merkle_kv_mobile/+/res

# Monitoring service user
user monitoring_service
topic read merkle_kv_mobile/+/status
topic read merkle_kv_mobile/+/metrics
topic read $SYS/#

# Backup service user
user backup_service
topic read merkle_kv_mobile/#

# =============================================================================
# Application-Specific Access
# =============================================================================

# Flutter demo app pattern
user flutter_demo
topic readwrite merkle_kv_mobile/flutter_demo/cmd
topic readwrite merkle_kv_mobile/flutter_demo/res
topic read merkle_kv_mobile/replication/events
topic write merkle_kv_mobile/replication/events

# React Native demo app pattern
user rn_demo
topic readwrite merkle_kv_mobile/rn_demo/cmd
topic readwrite merkle_kv_mobile/rn_demo/res
topic read merkle_kv_mobile/replication/events
topic write merkle_kv_mobile/replication/events

# CLI tool pattern
user cli_tool
topic readwrite merkle_kv_mobile/cli_tool/cmd
topic readwrite merkle_kv_mobile/cli_tool/res
topic read merkle_kv_mobile/+/cmd
topic read merkle_kv_mobile/+/res
topic read merkle_kv_mobile/replication/events
topic write merkle_kv_mobile/replication/events

# =============================================================================
# Testing Users
# =============================================================================

# Test user with limited access
user test_user
topic readwrite merkle_kv_mobile/test_user/cmd
topic readwrite merkle_kv_mobile/test_user/res
topic read merkle_kv_mobile/replication/events

# Integration test user
user integration_test
topic readwrite merkle_kv_mobile/test/#
topic readwrite merkle_kv_mobile/replication/events

# =============================================================================
# Development Users
# =============================================================================

# Developer user with broad access for debugging
user developer
topic readwrite merkle_kv_mobile/dev/#
topic read merkle_kv_mobile/+/cmd
topic read merkle_kv_mobile/+/res
topic readwrite merkle_kv_mobile/replication/events
topic read merkle_kv_mobile/antientropy/+

# =============================================================================
# Anonymous Access (Denied)
# =============================================================================

# Explicitly deny all access for anonymous users
user anonymous
topic deny #

# =============================================================================
# Default Fallback (Deny All)
# =============================================================================

# Any user not explicitly granted access is denied
# This is the default behavior, but we make it explicit
pattern deny #
